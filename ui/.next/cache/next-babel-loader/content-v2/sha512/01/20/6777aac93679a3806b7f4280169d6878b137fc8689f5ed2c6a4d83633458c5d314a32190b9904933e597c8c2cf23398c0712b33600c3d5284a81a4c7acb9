{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/ranwahle/dev/10n1/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/Users/ranwahle/dev/10n1/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/ranwahle/dev/10n1/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/ranwahle/dev/10n1/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext, useCallback, useContext, useRef, useState } from 'react';\nimport { useGoogleLogin, useGoogleLogout } from 'react-google-login';\nimport { Container, Spinner } from 'reactstrap';\nimport http from 'axios';\nimport { useRouter } from 'next/router';\nimport { useMutation } from '@apollo/client';\nimport client from '../apollo-client';\nimport { GET_EXPERT_BY_EMAIL } from '../graphql/queries';\nimport { CREATE_EXPERT } from '../graphql/mutations';\nexport var AuthContext = /*#__PURE__*/createContext({});\nvar googleClientId = '158154804757-5oja12b2flilb717ndvrdct3or8uqjqi.apps.googleusercontent.com';\nexport var AuthProvider = function AuthProvider(_ref) {\n  var _userDataRef$current16;\n\n  var children = _ref.children;\n\n  var _useMutation = useMutation(CREATE_EXPERT),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      createExpert = _useMutation2[0];\n\n  var _useState = useState(false),\n      isLoggedIn = _useState[0],\n      setIsLoggedIn = _useState[1];\n\n  var _useState2 = useState(true),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var userDataRef = useRef({});\n  var router = useRouter();\n\n  var onSuccess = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n      var _response$tokenObj, _userDataRef$current, _userDataRef$current2, _userDataRef$current8, _userDataRef$current9, _userDataRef$current10, _userDataRef$current11, _userDataRef$current12, _userDataRef$current13, _userDataRef$current14;\n\n      var _response$tokenObj2, _data$phoneNumbers, _data$phoneNumbers$, _yield$http$get, data, _data$phoneNumbers$2, _userDataRef$current3, _yield$client$query, _data, _userDataRef$current4, _userDataRef$current5, _userDataRef$current6, _userDataRef$current7;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setIsLoading(true);\n              setIsLoggedIn(true);\n              userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), {}, {\n                name: response.profileObj.name,\n                email: response.profileObj.email,\n                image: response.profileObj.imageUrl\n              });\n\n              if (!(response !== null && response !== void 0 && (_response$tokenObj = response.tokenObj) !== null && _response$tokenObj !== void 0 && _response$tokenObj.access_token && !(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current = userDataRef.current) !== null && _userDataRef$current !== void 0 && _userDataRef$current.phone))) {\n                _context.next = 9;\n                break;\n              }\n\n              _context.next = 6;\n              return http.get('https://people.googleapis.com/v1/people/me?personFields=phoneNumbers', {\n                headers: {\n                  Authorization: \"Bearer \".concat(response === null || response === void 0 ? void 0 : (_response$tokenObj2 = response.tokenObj) === null || _response$tokenObj2 === void 0 ? void 0 : _response$tokenObj2.access_token)\n                }\n              });\n\n            case 6:\n              _yield$http$get = _context.sent;\n              data = _yield$http$get.data;\n\n              if (data !== null && data !== void 0 && (_data$phoneNumbers = data.phoneNumbers) !== null && _data$phoneNumbers !== void 0 && (_data$phoneNumbers$ = _data$phoneNumbers[0]) !== null && _data$phoneNumbers$ !== void 0 && _data$phoneNumbers$.value) {\n                userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), {}, {\n                  phone: (data === null || data === void 0 ? void 0 : (_data$phoneNumbers$2 = data.phoneNumbers[0]) === null || _data$phoneNumbers$2 === void 0 ? void 0 : _data$phoneNumbers$2.value) || null\n                });\n              }\n\n            case 9:\n              if (!((_userDataRef$current2 = userDataRef.current) !== null && _userDataRef$current2 !== void 0 && _userDataRef$current2.email)) {\n                _context.next = 20;\n                break;\n              }\n\n              _context.next = 12;\n              return client.query({\n                query: GET_EXPERT_BY_EMAIL,\n                variables: {\n                  email: (_userDataRef$current3 = userDataRef.current) === null || _userDataRef$current3 === void 0 ? void 0 : _userDataRef$current3.email\n                }\n              });\n\n            case 12:\n              _yield$client$query = _context.sent;\n              _data = _yield$client$query.data;\n\n              if (!(_data !== null && _data !== void 0 && _data.expert)) {\n                _context.next = 18;\n                break;\n              }\n\n              userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), _data.expert);\n              _context.next = 20;\n              break;\n\n            case 18:\n              _context.next = 20;\n              return createExpert({\n                variables: {\n                  input: {\n                    name: ((_userDataRef$current4 = userDataRef.current) === null || _userDataRef$current4 === void 0 ? void 0 : _userDataRef$current4.name) || '',\n                    phone: ((_userDataRef$current5 = userDataRef.current) === null || _userDataRef$current5 === void 0 ? void 0 : _userDataRef$current5.phone) || '',\n                    email: ((_userDataRef$current6 = userDataRef.current) === null || _userDataRef$current6 === void 0 ? void 0 : _userDataRef$current6.email) || '',\n                    image: ((_userDataRef$current7 = userDataRef.current) === null || _userDataRef$current7 === void 0 ? void 0 : _userDataRef$current7.image) || ''\n                  }\n                }\n              });\n\n            case 20:\n              if (!((_userDataRef$current8 = userDataRef.current) !== null && _userDataRef$current8 !== void 0 && (_userDataRef$current9 = _userDataRef$current8.slackData) !== null && _userDataRef$current9 !== void 0 && _userDataRef$current9.accessToken)) {\n                router.push('/registration/step2');\n              } else if (!(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current10 = userDataRef.current) !== null && _userDataRef$current10 !== void 0 && (_userDataRef$current11 = _userDataRef$current10.expertise) !== null && _userDataRef$current11 !== void 0 && _userDataRef$current11.length)) {\n                router.push('/registration/step3');\n              } else if (!(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current12 = userDataRef.current) !== null && _userDataRef$current12 !== void 0 && (_userDataRef$current13 = _userDataRef$current12.availability) !== null && _userDataRef$current13 !== void 0 && _userDataRef$current13.length)) {\n                router.push('/registration/step4');\n              } else if (!(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current14 = userDataRef.current) !== null && _userDataRef$current14 !== void 0 && _userDataRef$current14.bio)) {\n                router.push('/registration/step5');\n              }\n\n              setIsLoading(false);\n\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onSuccess(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onLogout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setIsLoading(false);\n              userDataRef.current = {};\n              _context2.next = 4;\n              return router.push('/');\n\n            case 4:\n              _context2.next = 6;\n              return router.reload();\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onLogout() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onFailure = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setIsLoading(false);\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onFailure() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onAutoLoadFinished = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(connected) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              console.warn({\n                connected: connected\n              });\n\n              if (!connected) {\n                setIsLoading(false);\n              }\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function onAutoLoadFinished(_x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var refetch = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n    var _userDataRef$current15;\n\n    var _yield$client$query2, data;\n\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return client.query({\n              query: GET_EXPERT_BY_EMAIL,\n              variables: {\n                email: (_userDataRef$current15 = userDataRef.current) === null || _userDataRef$current15 === void 0 ? void 0 : _userDataRef$current15.email\n              }\n            });\n\n          case 2:\n            _yield$client$query2 = _context5.sent;\n            data = _yield$client$query2.data;\n\n            if (data !== null && data !== void 0 && data.expert) {\n              userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), data.expert);\n            }\n\n            return _context5.abrupt(\"return\", data === null || data === void 0 ? void 0 : data.expert);\n\n          case 6:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  })), [userDataRef.current]);\n\n  var _useGoogleLogin = useGoogleLogin({\n    // @ts-ignore\n    onSuccess: onSuccess,\n    onFailure: onFailure,\n    onAutoLoadFinished: onAutoLoadFinished,\n    clientId: googleClientId,\n    cookiePolicy: 'single_host_origin',\n    isSignedIn: true,\n    scope: 'https://www.googleapis.com/auth/user.phonenumbers.read',\n    redirectUri: true ? 'https://10n1.tikalk.dev/registration/step2' : 'http://localhost:3000/registration/step2'\n  }),\n      signIn = _useGoogleLogin.signIn;\n\n  var _useGoogleLogout = useGoogleLogout({\n    onLogoutSuccess: onLogout,\n    clientId: googleClientId,\n    cookiePolicy: 'single_host_origin'\n  }),\n      signOut = _useGoogleLogout.signOut;\n\n  return /*#__PURE__*/_jsx(AuthContext.Provider, {\n    value: {\n      isLoggedIn: isLoggedIn,\n      userData: (_userDataRef$current16 = userDataRef.current) !== null && _userDataRef$current16 !== void 0 ? _userDataRef$current16 : {},\n      login: signIn,\n      logout: signOut,\n      isLoading: isLoading,\n      refetch: refetch\n    },\n    children: isLoading ? /*#__PURE__*/_jsx(Container, {\n      className: \"d-flex align-items-center justify-content-center vh-100\",\n      children: /*#__PURE__*/_jsx(Spinner, {\n        size: \"lg\",\n        color: \"warning\"\n      })\n    }) : children\n  });\n};\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\nexport default useAuth;","map":null,"metadata":{},"sourceType":"module"}