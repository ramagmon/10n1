{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/ranwahle/tests/10n1/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/Users/ranwahle/tests/10n1/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/ranwahle/tests/10n1/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/ranwahle/tests/10n1/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/ranwahle/tests/10n1/ui/hooks/useAuth.tsx\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext, useCallback, useContext, useRef, useState } from 'react';\nimport { useGoogleLogin, useGoogleLogout } from 'react-google-login';\nimport { Container, Spinner } from 'reactstrap';\nimport http from 'axios';\nimport { useRouter } from 'next/router';\nimport { useMutation } from '@apollo/client';\nimport client from '../apollo-client';\nimport { GET_EXPERT_BY_EMAIL } from '../graphql/queries';\nimport { CREATE_EXPERT } from '../graphql/mutations';\nexport var AuthContext = /*#__PURE__*/createContext({});\nvar googleClientId = '158154804757-5oja12b2flilb717ndvrdct3or8uqjqi.apps.googleusercontent.com';\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var _userDataRef$current16;\n\n  var children = _ref.children;\n\n  var _useMutation = useMutation(CREATE_EXPERT),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      createExpert = _useMutation2[0];\n\n  var _useState = useState(false),\n      isLoggedIn = _useState[0],\n      setIsLoggedIn = _useState[1];\n\n  var _useState2 = useState(true),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var userDataRef = useRef({});\n  var router = useRouter();\n\n  var onSuccess = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n      var _response$tokenObj, _userDataRef$current, _userDataRef$current2, _userDataRef$current8, _userDataRef$current9, _userDataRef$current10, _userDataRef$current11, _userDataRef$current12, _userDataRef$current13, _userDataRef$current14;\n\n      var _response$tokenObj2, _data$phoneNumbers, _data$phoneNumbers$, _yield$http$get, data, _data$phoneNumbers$2, _userDataRef$current3, _yield$client$query, _data, _userDataRef$current4, _userDataRef$current5, _userDataRef$current6, _userDataRef$current7;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setIsLoading(true);\n              setIsLoggedIn(true);\n              userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), {}, {\n                name: response.profileObj.name,\n                email: response.profileObj.email,\n                image: response.profileObj.imageUrl\n              });\n\n              if (!(response !== null && response !== void 0 && (_response$tokenObj = response.tokenObj) !== null && _response$tokenObj !== void 0 && _response$tokenObj.access_token && !(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current = userDataRef.current) !== null && _userDataRef$current !== void 0 && _userDataRef$current.phone))) {\n                _context.next = 9;\n                break;\n              }\n\n              _context.next = 6;\n              return http.get('https://people.googleapis.com/v1/people/me?personFields=phoneNumbers', {\n                headers: {\n                  Authorization: \"Bearer \".concat(response === null || response === void 0 ? void 0 : (_response$tokenObj2 = response.tokenObj) === null || _response$tokenObj2 === void 0 ? void 0 : _response$tokenObj2.access_token)\n                }\n              });\n\n            case 6:\n              _yield$http$get = _context.sent;\n              data = _yield$http$get.data;\n\n              if (data !== null && data !== void 0 && (_data$phoneNumbers = data.phoneNumbers) !== null && _data$phoneNumbers !== void 0 && (_data$phoneNumbers$ = _data$phoneNumbers[0]) !== null && _data$phoneNumbers$ !== void 0 && _data$phoneNumbers$.value) {\n                userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), {}, {\n                  phone: (data === null || data === void 0 ? void 0 : (_data$phoneNumbers$2 = data.phoneNumbers[0]) === null || _data$phoneNumbers$2 === void 0 ? void 0 : _data$phoneNumbers$2.value) || null\n                });\n              }\n\n            case 9:\n              if (!((_userDataRef$current2 = userDataRef.current) !== null && _userDataRef$current2 !== void 0 && _userDataRef$current2.email)) {\n                _context.next = 20;\n                break;\n              }\n\n              _context.next = 12;\n              return client.query({\n                query: GET_EXPERT_BY_EMAIL,\n                variables: {\n                  email: (_userDataRef$current3 = userDataRef.current) === null || _userDataRef$current3 === void 0 ? void 0 : _userDataRef$current3.email\n                }\n              });\n\n            case 12:\n              _yield$client$query = _context.sent;\n              _data = _yield$client$query.data;\n\n              if (!(_data !== null && _data !== void 0 && _data.expert)) {\n                _context.next = 18;\n                break;\n              }\n\n              userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), _data.expert);\n              _context.next = 20;\n              break;\n\n            case 18:\n              _context.next = 20;\n              return createExpert({\n                variables: {\n                  input: {\n                    name: ((_userDataRef$current4 = userDataRef.current) === null || _userDataRef$current4 === void 0 ? void 0 : _userDataRef$current4.name) || '',\n                    phone: ((_userDataRef$current5 = userDataRef.current) === null || _userDataRef$current5 === void 0 ? void 0 : _userDataRef$current5.phone) || '',\n                    email: ((_userDataRef$current6 = userDataRef.current) === null || _userDataRef$current6 === void 0 ? void 0 : _userDataRef$current6.email) || '',\n                    image: ((_userDataRef$current7 = userDataRef.current) === null || _userDataRef$current7 === void 0 ? void 0 : _userDataRef$current7.image) || ''\n                  }\n                }\n              });\n\n            case 20:\n              if (!((_userDataRef$current8 = userDataRef.current) !== null && _userDataRef$current8 !== void 0 && (_userDataRef$current9 = _userDataRef$current8.slackData) !== null && _userDataRef$current9 !== void 0 && _userDataRef$current9.accessToken)) {\n                router.push('/registration/step2');\n              } else if (!(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current10 = userDataRef.current) !== null && _userDataRef$current10 !== void 0 && (_userDataRef$current11 = _userDataRef$current10.expertise) !== null && _userDataRef$current11 !== void 0 && _userDataRef$current11.length)) {\n                router.push('/registration/step3');\n              } else if (!(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current12 = userDataRef.current) !== null && _userDataRef$current12 !== void 0 && (_userDataRef$current13 = _userDataRef$current12.availability) !== null && _userDataRef$current13 !== void 0 && _userDataRef$current13.length)) {\n                router.push('/registration/step4');\n              } else if (!(userDataRef !== null && userDataRef !== void 0 && (_userDataRef$current14 = userDataRef.current) !== null && _userDataRef$current14 !== void 0 && _userDataRef$current14.bio)) {\n                router.push('/registration/step5');\n              }\n\n              setIsLoading(false);\n\n            case 22:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onSuccess(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onLogout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setIsLoading(false);\n              userDataRef.current = {};\n              _context2.next = 4;\n              return router.push('/');\n\n            case 4:\n              _context2.next = 6;\n              return router.reload();\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onLogout() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onFailure = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setIsLoading(false);\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onFailure() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onAutoLoadFinished = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(connected) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              console.warn({\n                connected: connected\n              });\n\n              if (!connected) {\n                setIsLoading(false);\n              }\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function onAutoLoadFinished(_x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var refetch = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n    var _userDataRef$current15;\n\n    var _yield$client$query2, data;\n\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return client.query({\n              query: GET_EXPERT_BY_EMAIL,\n              variables: {\n                email: (_userDataRef$current15 = userDataRef.current) === null || _userDataRef$current15 === void 0 ? void 0 : _userDataRef$current15.email\n              }\n            });\n\n          case 2:\n            _yield$client$query2 = _context5.sent;\n            data = _yield$client$query2.data;\n\n            if (data !== null && data !== void 0 && data.expert) {\n              userDataRef.current = _objectSpread(_objectSpread({}, userDataRef.current), data.expert);\n            }\n\n            return _context5.abrupt(\"return\", data === null || data === void 0 ? void 0 : data.expert);\n\n          case 6:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  })), [userDataRef.current]);\n\n  var _useGoogleLogin = useGoogleLogin({\n    // @ts-ignore\n    onSuccess: onSuccess,\n    onFailure: onFailure,\n    onAutoLoadFinished: onAutoLoadFinished,\n    clientId: googleClientId,\n    cookiePolicy: 'single_host_origin',\n    isSignedIn: true,\n    scope: 'https://www.googleapis.com/auth/user.phonenumbers.read',\n    redirectUri: false ? 'https://10n1.tikalk.dev/registration/step2' : 'http://localhost:3000/registration/step2'\n  }),\n      signIn = _useGoogleLogin.signIn;\n\n  var _useGoogleLogout = useGoogleLogout({\n    onLogoutSuccess: onLogout,\n    clientId: googleClientId,\n    cookiePolicy: 'single_host_origin'\n  }),\n      signOut = _useGoogleLogout.signOut;\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      isLoggedIn: isLoggedIn,\n      userData: (_userDataRef$current16 = userDataRef.current) !== null && _userDataRef$current16 !== void 0 ? _userDataRef$current16 : {},\n      login: signIn,\n      logout: signOut,\n      isLoading: isLoading,\n      refetch: refetch\n    },\n    children: isLoading ? /*#__PURE__*/_jsxDEV(Container, {\n      className: \"d-flex align-items-center justify-content-center vh-100\",\n      children: /*#__PURE__*/_jsxDEV(Spinner, {\n        size: \"lg\",\n        color: \"warning\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 11\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }, _this) : children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 140,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(AuthProvider, \"7qCPlZ6JG1eC2VkbLmo1ey3jxD8=\", false, function () {\n  return [useMutation, useRouter, useGoogleLogin, useGoogleLogout];\n});\n\n_c = AuthProvider;\nexport var useAuth = function useAuth() {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport default useAuth;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/ranwahle/tests/10n1/ui/hooks/useAuth.tsx"],"names":["createContext","useCallback","useContext","useRef","useState","useGoogleLogin","useGoogleLogout","Container","Spinner","http","useRouter","useMutation","client","GET_EXPERT_BY_EMAIL","CREATE_EXPERT","AuthContext","googleClientId","AuthProvider","children","createExpert","isLoggedIn","setIsLoggedIn","isLoading","setIsLoading","userDataRef","router","onSuccess","response","current","name","profileObj","email","image","imageUrl","tokenObj","access_token","phone","get","headers","Authorization","data","phoneNumbers","value","query","variables","expert","input","slackData","accessToken","push","expertise","length","availability","bio","onLogout","reload","onFailure","onAutoLoadFinished","connected","console","warn","refetch","clientId","cookiePolicy","isSignedIn","scope","redirectUri","signIn","onLogoutSuccess","signOut","userData","login","logout","useAuth"],"mappings":";;;;;;;;;;;;;;;AAAA,SACEA,aADF,EAEEC,WAFF,EAGEC,UAHF,EAIEC,MAJF,EAKEC,QALF,QAMO,OANP;AAOA,SAASC,cAAT,EAAyBC,eAAzB,QAAgD,oBAAhD;AACA,SAASC,SAAT,EAAoBC,OAApB,QAAmC,YAAnC;AACA,OAAOC,IAAP,MAAiB,OAAjB;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,WAAT,QAA4B,gBAA5B;AACA,OAAOC,MAAP,MAAmB,kBAAnB;AACA,SAASC,mBAAT,QAAoC,oBAApC;AACA,SAASC,aAAT,QAA8B,sBAA9B;AAEA,OAAO,IAAMC,WAAW,gBAAGf,aAAa,CAAC,EAAD,CAAjC;AAEP,IAAMgB,cAAc,GAClB,0EADF;AAGA,OAAO,IAAMC,YAAY,GAAG,SAAfA,YAAe,OAAuB;AAAA;;AAAA;;AAAA,MAApBC,QAAoB,QAApBA,QAAoB;;AAAA,qBAC1BP,WAAW,CAACG,aAAD,CADe;AAAA;AAAA,MAC1CK,YAD0C;;AAAA,kBAEbf,QAAQ,CAAC,KAAD,CAFK;AAAA,MAE1CgB,UAF0C;AAAA,MAE9BC,aAF8B;;AAAA,mBAGfjB,QAAQ,CAAC,IAAD,CAHO;AAAA,MAG1CkB,SAH0C;AAAA,MAG/BC,YAH+B;;AAIjD,MAAMC,WAAgB,GAAGrB,MAAM,CAAC,EAAD,CAA/B;AACA,MAAMsB,MAAM,GAAGf,SAAS,EAAxB;;AAEA,MAAMgB,SAAS;AAAA,yEAAG,iBAAOC,QAAP;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAChBJ,cAAAA,YAAY,CAAC,IAAD,CAAZ;AACAF,cAAAA,aAAa,CAAC,IAAD,CAAb;AACAG,cAAAA,WAAW,CAACI,OAAZ,mCACKJ,WAAW,CAACI,OADjB;AAEEC,gBAAAA,IAAI,EAAEF,QAAQ,CAACG,UAAT,CAAoBD,IAF5B;AAGEE,gBAAAA,KAAK,EAAEJ,QAAQ,CAACG,UAAT,CAAoBC,KAH7B;AAIEC,gBAAAA,KAAK,EAAEL,QAAQ,CAACG,UAAT,CAAoBG;AAJ7B;;AAHgB,oBAUZN,QAAQ,SAAR,IAAAA,QAAQ,WAAR,0BAAAA,QAAQ,CAAEO,QAAV,kEAAoBC,YAApB,IAAoC,EAACX,WAAD,aAACA,WAAD,uCAACA,WAAW,CAAEI,OAAd,iDAAC,qBAAsBQ,KAAvB,CAVxB;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAWS3B,IAAI,CAAC4B,GAAL,CACrB,sEADqB,EAErB;AACEC,gBAAAA,OAAO,EAAE;AACPC,kBAAAA,aAAa,mBAAYZ,QAAZ,aAAYA,QAAZ,8CAAYA,QAAQ,CAAEO,QAAtB,wDAAY,oBAAoBC,YAAhC;AADN;AADX,eAFqB,CAXT;;AAAA;AAAA;AAWNK,cAAAA,IAXM,mBAWNA,IAXM;;AAmBd,kBAAIA,IAAJ,aAAIA,IAAJ,qCAAIA,IAAI,CAAEC,YAAV,sEAAI,mBAAqB,CAArB,CAAJ,gDAAI,oBAAyBC,KAA7B,EAAoC;AAClClB,gBAAAA,WAAW,CAACI,OAAZ,mCACKJ,WAAW,CAACI,OADjB;AAEEQ,kBAAAA,KAAK,EAAE,CAAAI,IAAI,SAAJ,IAAAA,IAAI,WAAJ,oCAAAA,IAAI,CAAEC,YAAN,CAAmB,CAAnB,+EAAuBC,KAAvB,KAAgC;AAFzC;AAID;;AAxBa;AAAA,6CA2BZlB,WAAW,CAACI,OA3BA,kDA2BZ,sBAAqBG,KA3BT;AAAA;AAAA;AAAA;;AAAA;AAAA,qBA4BSnB,MAAM,CAAC+B,KAAP,CAAa;AAClCA,gBAAAA,KAAK,EAAE9B,mBAD2B;AAElC+B,gBAAAA,SAAS,EAAE;AAAEb,kBAAAA,KAAK,2BAAEP,WAAW,CAACI,OAAd,0DAAE,sBAAqBG;AAA9B;AAFuB,eAAb,CA5BT;;AAAA;AAAA;AA4BNS,cAAAA,KA5BM,uBA4BNA,IA5BM;;AAAA,oBAgCVA,KAhCU,aAgCVA,KAhCU,eAgCVA,KAAI,CAAEK,MAhCI;AAAA;AAAA;AAAA;;AAiCZrB,cAAAA,WAAW,CAACI,OAAZ,mCAA2BJ,WAAW,CAACI,OAAvC,GAAmDY,KAAI,CAACK,MAAxD;AAjCY;AAAA;;AAAA;AAAA;AAAA,qBAmCN1B,YAAY,CAAC;AACjByB,gBAAAA,SAAS,EAAE;AACTE,kBAAAA,KAAK,EAAE;AACLjB,oBAAAA,IAAI,EAAE,0BAAAL,WAAW,CAACI,OAAZ,gFAAqBC,IAArB,KAA6B,EAD9B;AAELO,oBAAAA,KAAK,EAAE,0BAAAZ,WAAW,CAACI,OAAZ,gFAAqBQ,KAArB,KAA8B,EAFhC;AAGLL,oBAAAA,KAAK,EAAE,0BAAAP,WAAW,CAACI,OAAZ,gFAAqBG,KAArB,KAA8B,EAHhC;AAILC,oBAAAA,KAAK,EAAE,0BAAAR,WAAW,CAACI,OAAZ,gFAAqBI,KAArB,KAA8B;AAJhC;AADE;AADM,eAAD,CAnCN;;AAAA;AAgDhB,kBAAI,2BAACR,WAAW,CAACI,OAAb,2EAAC,sBAAqBmB,SAAtB,kDAAC,sBAAgCC,WAAjC,CAAJ,EAAkD;AAChDvB,gBAAAA,MAAM,CAACwB,IAAP,CAAY,qBAAZ;AACD,eAFD,MAEO,IAAI,EAACzB,WAAD,aAACA,WAAD,yCAACA,WAAW,CAAEI,OAAd,6EAAC,uBAAsBsB,SAAvB,mDAAC,uBAAiCC,MAAlC,CAAJ,EAA8C;AACnD1B,gBAAAA,MAAM,CAACwB,IAAP,CAAY,qBAAZ;AACD,eAFM,MAEA,IAAI,EAACzB,WAAD,aAACA,WAAD,yCAACA,WAAW,CAAEI,OAAd,6EAAC,uBAAsBwB,YAAvB,mDAAC,uBAAoCD,MAArC,CAAJ,EAAiD;AACtD1B,gBAAAA,MAAM,CAACwB,IAAP,CAAY,qBAAZ;AACD,eAFM,MAEA,IAAI,EAACzB,WAAD,aAACA,WAAD,yCAACA,WAAW,CAAEI,OAAd,mDAAC,uBAAsByB,GAAvB,CAAJ,EAAgC;AACrC5B,gBAAAA,MAAM,CAACwB,IAAP,CAAY,qBAAZ;AACD;;AACD1B,cAAAA,YAAY,CAAC,KAAD,CAAZ;;AAzDgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAATG,SAAS;AAAA;AAAA;AAAA,KAAf;;AA4DA,MAAM4B,QAAQ;AAAA,yEAAG;AAAA;AAAA;AAAA;AAAA;AACf/B,cAAAA,YAAY,CAAC,KAAD,CAAZ;AACAC,cAAAA,WAAW,CAACI,OAAZ,GAAsB,EAAtB;AAFe;AAAA,qBAGTH,MAAM,CAACwB,IAAP,CAAY,GAAZ,CAHS;;AAAA;AAAA;AAAA,qBAITxB,MAAM,CAAC8B,MAAP,EAJS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAARD,QAAQ;AAAA;AAAA;AAAA,KAAd;;AAOA,MAAME,SAAS;AAAA,yEAAG;AAAA;AAAA;AAAA;AAAA;AAChBjC,cAAAA,YAAY,CAAC,KAAD,CAAZ;;AADgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAATiC,SAAS;AAAA;AAAA;AAAA,KAAf;;AAIA,MAAMC,kBAAkB;AAAA,yEAAG,kBAAOC,SAAP;AAAA;AAAA;AAAA;AAAA;AACzBC,cAAAA,OAAO,CAACC,IAAR,CAAa;AAAEF,gBAAAA,SAAS,EAATA;AAAF,eAAb;;AACA,kBAAI,CAACA,SAAL,EAAgB;AACdnC,gBAAAA,YAAY,CAAC,KAAD,CAAZ;AACD;;AAJwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAlBkC,kBAAkB;AAAA;AAAA;AAAA,KAAxB;;AAOA,MAAMI,OAAO,GAAG5D,WAAW,wEAAC;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACHW,MAAM,CAAC+B,KAAP,CAAa;AAClCA,cAAAA,KAAK,EAAE9B,mBAD2B;AAElC+B,cAAAA,SAAS,EAAE;AAAEb,gBAAAA,KAAK,4BAAEP,WAAW,CAACI,OAAd,2DAAE,uBAAqBG;AAA9B;AAFuB,aAAb,CADG;;AAAA;AAAA;AAClBS,YAAAA,IADkB,wBAClBA,IADkB;;AAK1B,gBAAIA,IAAJ,aAAIA,IAAJ,eAAIA,IAAI,CAAEK,MAAV,EAAkB;AAChBrB,cAAAA,WAAW,CAACI,OAAZ,mCAA2BJ,WAAW,CAACI,OAAvC,GAAmDY,IAAI,CAACK,MAAxD;AACD;;AAPyB,8CAQnBL,IARmB,aAQnBA,IARmB,uBAQnBA,IAAI,CAAEK,MARa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IASxB,CAACrB,WAAW,CAACI,OAAb,CATwB,CAA3B;;AArFiD,wBAgG9BvB,cAAc,CAAC;AAChC;AACAqB,IAAAA,SAAS,EAATA,SAFgC;AAGhC8B,IAAAA,SAAS,EAATA,SAHgC;AAIhCC,IAAAA,kBAAkB,EAAlBA,kBAJgC;AAKhCK,IAAAA,QAAQ,EAAE9C,cALsB;AAMhC+C,IAAAA,YAAY,EAAE,oBANkB;AAOhCC,IAAAA,UAAU,EAAE,IAPoB;AAQhCC,IAAAA,KAAK,EAAE,wDARyB;AAShCC,IAAAA,WAAW,EACT,QACI,4CADJ,GAEI;AAZ0B,GAAD,CAhGgB;AAAA,MAgGzCC,MAhGyC,mBAgGzCA,MAhGyC;;AAAA,yBA+G7B7D,eAAe,CAAC;AAClC8D,IAAAA,eAAe,EAAEd,QADiB;AAElCQ,IAAAA,QAAQ,EAAE9C,cAFwB;AAGlC+C,IAAAA,YAAY,EAAE;AAHoB,GAAD,CA/Gc;AAAA,MA+GzCM,OA/GyC,oBA+GzCA,OA/GyC;;AAqHjD,sBACE,QAAC,WAAD,CAAa,QAAb;AACE,IAAA,KAAK,EAAE;AACLjD,MAAAA,UAAU,EAAVA,UADK;AAELkD,MAAAA,QAAQ,4BAAE9C,WAAW,CAACI,OAAd,2EAAyB,EAF5B;AAGL2C,MAAAA,KAAK,EAAEJ,MAHF;AAILK,MAAAA,MAAM,EAAEH,OAJH;AAKL/C,MAAAA,SAAS,EAATA,SALK;AAMLuC,MAAAA,OAAO,EAAPA;AANK,KADT;AAAA,cAUGvC,SAAS,gBACR,QAAC,SAAD;AAAW,MAAA,SAAS,EAAC,yDAArB;AAAA,6BACE,QAAC,OAAD;AAAS,QAAA,IAAI,EAAC,IAAd;AAAmB,QAAA,KAAK,EAAC;AAAzB;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,aADQ,GAKRJ;AAfJ;AAAA;AAAA;AAAA;AAAA,WADF;AAoBD,CAzIM;;GAAMD,Y;UACYN,W,EAIRD,S,EA2FIL,c,EAeCC,e;;;KA/GTW,Y;AA2Ib,OAAO,IAAMwD,OAAY,GAAG,SAAfA,OAAe;AAAA;;AAAA,SAAMvE,UAAU,CAACa,WAAD,CAAhB;AAAA,CAArB;;IAAM0D,O;;AAEb,eAAeA,OAAf","sourcesContent":["import {\n  createContext,\n  useCallback,\n  useContext,\n  useRef,\n  useState,\n} from 'react';\nimport { useGoogleLogin, useGoogleLogout } from 'react-google-login';\nimport { Container, Spinner } from 'reactstrap';\nimport http from 'axios';\nimport { useRouter } from 'next/router';\nimport { useMutation } from '@apollo/client';\nimport client from '../apollo-client';\nimport { GET_EXPERT_BY_EMAIL } from '../graphql/queries';\nimport { CREATE_EXPERT } from '../graphql/mutations';\n\nexport const AuthContext = createContext({});\n\nconst googleClientId =\n  '158154804757-5oja12b2flilb717ndvrdct3or8uqjqi.apps.googleusercontent.com';\n\nexport const AuthProvider = ({ children }: any) => {\n  const [createExpert] = useMutation(CREATE_EXPERT);\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const userDataRef: any = useRef({});\n  const router = useRouter();\n\n  const onSuccess = async (response) => {\n    setIsLoading(true);\n    setIsLoggedIn(true);\n    userDataRef.current = {\n      ...userDataRef.current,\n      name: response.profileObj.name,\n      email: response.profileObj.email,\n      image: response.profileObj.imageUrl,\n    };\n\n    if (response?.tokenObj?.access_token && !userDataRef?.current?.phone) {\n      const { data } = await http.get(\n        'https://people.googleapis.com/v1/people/me?personFields=phoneNumbers',\n        {\n          headers: {\n            Authorization: `Bearer ${response?.tokenObj?.access_token}`,\n          },\n        },\n      );\n      if (data?.phoneNumbers?.[0]?.value) {\n        userDataRef.current = {\n          ...userDataRef.current,\n          phone: data?.phoneNumbers[0]?.value || null,\n        };\n      }\n    }\n\n    if (userDataRef.current?.email) {\n      const { data } = await client.query({\n        query: GET_EXPERT_BY_EMAIL,\n        variables: { email: userDataRef.current?.email },\n      });\n      if (data?.expert) {\n        userDataRef.current = { ...userDataRef.current, ...data.expert };\n      } else {\n        await createExpert({\n          variables: {\n            input: {\n              name: userDataRef.current?.name || '',\n              phone: userDataRef.current?.phone || '',\n              email: userDataRef.current?.email || '',\n              image: userDataRef.current?.image || '',\n            },\n          },\n        });\n      }\n    }\n\n    if (!userDataRef.current?.slackData?.accessToken) {\n      router.push('/registration/step2');\n    } else if (!userDataRef?.current?.expertise?.length) {\n      router.push('/registration/step3');\n    } else if (!userDataRef?.current?.availability?.length) {\n      router.push('/registration/step4');\n    } else if (!userDataRef?.current?.bio) {\n      router.push('/registration/step5');\n    }\n    setIsLoading(false);\n  };\n\n  const onLogout = async () => {\n    setIsLoading(false);\n    userDataRef.current = {};\n    await router.push('/');\n    await router.reload();\n  };\n\n  const onFailure = async () => {\n    setIsLoading(false);\n  };\n\n  const onAutoLoadFinished = async (connected) => {\n    console.warn({ connected });\n    if (!connected) {\n      setIsLoading(false);\n    }\n  };\n\n  const refetch = useCallback(async () => {\n    const { data } = await client.query({\n      query: GET_EXPERT_BY_EMAIL,\n      variables: { email: userDataRef.current?.email },\n    });\n    if (data?.expert) {\n      userDataRef.current = { ...userDataRef.current, ...data.expert };\n    }\n    return data?.expert;\n  }, [userDataRef.current]);\n\n  const { signIn } = useGoogleLogin({\n    // @ts-ignore\n    onSuccess,\n    onFailure,\n    onAutoLoadFinished,\n    clientId: googleClientId,\n    cookiePolicy: 'single_host_origin',\n    isSignedIn: true,\n    scope: 'https://www.googleapis.com/auth/user.phonenumbers.read',\n    redirectUri:\n      process.env.NODE_ENV === 'production'\n        ? 'https://10n1.tikalk.dev/registration/step2'\n        : 'http://localhost:3000/registration/step2',\n  });\n\n  const { signOut } = useGoogleLogout({\n    onLogoutSuccess: onLogout,\n    clientId: googleClientId,\n    cookiePolicy: 'single_host_origin',\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        isLoggedIn,\n        userData: userDataRef.current ?? {},\n        login: signIn,\n        logout: signOut,\n        isLoading,\n        refetch,\n      }}\n    >\n      {isLoading ? (\n        <Container className=\"d-flex align-items-center justify-content-center vh-100\">\n          <Spinner size=\"lg\" color=\"warning\" />\n        </Container>\n      ) : (\n        children\n      )}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth: any = () => useContext(AuthContext);\n\nexport default useAuth;\n"]},"metadata":{},"sourceType":"module"}